<template>
  <div class="page" data-name="catalog">
    <div class="navbar"  style="background: #125e97;">
      <div class="navbar-inner sliding">
        <div class="left">
          <a href="/home/" class="link back">
            <i class="icon icon-back color-white"></i>
          </a>
        </div>
        <div class="title color-white" style="color:#fff;">Payment<br><small style="font-size: 14px;">Amount to pay : <span id="lblFinalAmount">{{$route.params.finalamount}}</span></small></div>
      </div>
    </div>
    <div class="page-content">
      <div class="block" id="coupoSection" style="display: none;">
          <strong>PREDERRED PAYMENT MODE FOR THIS OFFER</strong><br>
          <span id="lblOffer">{{$route.params.coupon}}</span>
      </div>
      <div class="block-title">
        WALLET
      </div>
      <div class="list links-list">
        <ul>
          <li>
            <div class="item-content">
              <div class="item-media">
                <img src="img/paytm.png" width="33" />
              </div>
              <div class="item-inner">
                <div class="item-title-row">
                  <div class="item-title">Paytm</div>
                </div>
              </div>
            </div>
          </li>
          <li>
            <div class="item-content">
              <div class="item-media">
                <img src="img/freecharge.png" width="33" />
              </div>
              <div class="item-inner">
                <div class="item-title-row">
                  <div class="item-title">Freecharge</div>
                </div>
              </div>
            </div>
          </li>
          <li>
            <div class="item-content">
              <div class="item-media">
                <img src="img/phonepe.png" width="33" />
              </div>
              <div class="item-inner">
                <div class="item-title-row">
                  <div class="item-title">PhonePe</div>
                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>

      <div class="block-title">
        ONLINE PAYMENT
      </div>
      <div class="list">
        <ul>
          <li @click="payOnline">
            <label class="item-radio item-content">
              <input type="radio" name="onlinePayment" value="Books" checked />
              <i class="icon icon-radio"></i>
              <div class="item-inner">
                <div class="item-title">Online</div>
              </div>
            </label>
          </li>
          <li @click="payOnline">
            <label class="item-radio item-content">
              <input type="radio" name="onlinePayment" value="Movies" />
              <i class="icon icon-radio"></i>
              <div class="item-inner">
                <div class="item-title">Online</div>
              </div>
            </label>
          </li>
          <li  @click="payOnline">
            <label class="item-radio item-content">
              <input type="radio" name="onlinePayment" value="Food" />
              <i class="icon icon-radio"></i>
              <div class="item-inner">
                <div class="item-title">RezorPay</div>
              </div>
            </label>
          </li>
          <li @click="payOnline">
            <label class="item-radio item-content">
              <input type="radio" name="onlinePayment" value="Drinks" />
              <i class="icon icon-radio"></i>
              <div class="item-inner">
                <div class="item-title">JusPay</div>
              </div>
            </label>
          </li>
        </ul>
      </div>
      <!-- <div class="list links-list">
        <ul>
          <li>
            <div class="item-content">
              <div class="item-media">
                <img src="img/paytm.png" width="33" />
              </div>
              <div class="item-inner">
                <div class="item-title-row">
                  <div class="item-title">Paytm</div>
                </div>
              </div>
            </div>
          </li>
          <li>
            <div class="item-content">
              <div class="item-media">
                <img src="img/lazypay.png" width="33" />
              </div>
              <div class="item-inner">
                <div class="item-title-row">
                  <div class="item-title">Lazypay</div>
                </div>
              </div>
            </div>
          </li>
          <li>
            <div class="item-content">
              <div class="item-media">
                <img src="img/payu.png" width="33" />
              </div>
              <div class="item-inner">
                <div class="item-title-row">
                  <div class="item-title">PayU</div>
                </div>
              </div>
            </div>
          </li>
          <li>
            <div class="item-content">
              <div class="item-media">
                <img src="img/freecharge.png" width="33" />
              </div>
              <div class="item-inner">
                <div class="item-title-row">
                  <div class="item-title">Freecharge</div>
                </div>
              </div>
            </div>
          </li>
          <li>
            <div class="item-content">
              <div class="item-media">
                <img src="img/phonepe.png" width="33" />
              </div>
              <div class="item-inner">
                <div class="item-title-row">
                  <div class="item-title">PhonePe</div>
                </div>
              </div>
            </div>
          </li>
        </ul>
      </div> -->

      <div class="block-title">
        PAY ON DELIVERY
      </div>
      <div class="list media-list inset">
        <ul>
          <li>
            <div class="item-content">
              <label class="item-checkbox item-content">
                <input type="checkbox" name="demo-media-checkbox" id="chkCOD" value="1" />
                <i class="icon icon-checkbox"></i>
              <div class="item-inner">
                <div class="item-title-row">
                  <div class="item-title">Cash</i></div>
                </div>
                <div class="item-subtitle" style="white-space:unset;">Please keep exact change handy to help us serve you better</div>
              </div>
            </div>
          </li>
          
        </ul>
      </div>

      <div class="block">
        <button class="button button-fill color-green" id="btnPayOnDelivery" @click="payOrder">PAY ON DELIVERY</button>
      </div>
    </div>
  </div>
</template>
<script>
  
  return {
    methods: {
      payOrder: function(){
        var ref = cordova.InAppBrowser.open('http://platterexoticfood.com/paydir.php', '_blank', 'location=yes');
        // var myCallback = function (event) { console.log(event.url); }
        ref.addEventListener('loadstart', function (event) {
          var urlSuccessPage = "https://www.platterexoticfood.com/success.php";
          if (event.url == urlSuccessPage) {
            ref.close();
          }
        });
        // ref.addEventListener('loadstart', myCallback);
        // ref.removeEventListener('loadstart', myCallback);

        // let deliveryAddress = $('#lblDeliveryAddress').html()
        // let splitAddress = deliveryAddress.split(",")
        // let finalAmount =  $('#lblFinalAmount').html()
        // console.log(deliveryAddress)

        // if($('#chkCOD').not(':checked').length) {
        //   window.plugins.toast.showLongBottom('Select Payment Option');
        // }
        // else{
        //   app.payNow(deliveryAddress, splitAddress[3].trim(), splitAddress[1].trim(), splitAddress[2].trim(), 'cod', localStorage.getItem('couponCode'), '');
        // }


        // var data = {
        //   key: 'rinjrna1',
        //   txnid: '1237upty34',
        //   hash: '52c16423e7d4888baae9fe7d2cf05ed8d3086c49c666816fcf52b63e041a5b0ba865ce9f4ebf39717c6fa1832769179abbe964c8fff7a1833c3c6ad03a02a90e',
        //   amount: 1,
        //   firstname: 'saikat',
        //   email: 'saikat.projukti@gmail.com',
        //   phone: '8335887999',
        //   productinfo: 'testbag',
        //   surl: 'https://redbusket.com/index.php/Index/testsucc',
        //   furl: 'https://redbusket.com/index.php/Index/testfail'
        // }

        // var handler = {

        //   responseHandler: function (BOLT) {

        //     console.log(BOLT.response.txnStatus);

        //   },
        //   catchException: function (BOLT) {

        //     alert(BOLT.message);

        //   }
        // }

        // bolt.launch(data, handler); 

      },
      // payOnline: function(){
      //   app.payOnline();
      // }
      //   // console.log('I am here');
      //    var orderId = Date.now();
      //   var orderCreationRequest = new XMLHttpRequest();
      //   orderCreationRequest.open('POST', 'https://sandbox.juspay.in/order/create', true, '9F64B727D4C048C08013EA0935BCBDB5', '');
      //   orderCreationRequest.withCredentials = true;

      //   orderCreationRequest.setRequestHeader('Authorization', 'OUY2NEI3MjdENEMwNDhDMDgwMTNFQTA5MzVCQ0JEQjU6');
      //   orderCreationRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

      //   var errorCallback = function () {
      //     body.classList.remove('active');
      //     body.classList.add('error');

      //     window.setTimeout(function () {
      //       body.classList.remove('error');
      //       body.classList.add('active');
      //     }, 2000);
      //   };

      //   var successCallback = function () {
      //     body.classList.remove('active');
      //     body.classList.add('success');

      //     window.setTimeout(function () {
      //       body.classList.remove('success');
      //       body.classList.add('active');
      //     }, 2000);
      //   };


      //   orderCreationRequest.onreadystatechange = function () {
      //     if (orderCreationRequest.readyState == 4) {
      //       if (orderCreationRequest.status == 200) {
      //         ExpressCheckout.startCheckoutActivity({
      //           endUrls: ['https:\\/\\/test.com.\\/'],
      //           onEndUrlReached: function () {
      //             successCallback();
      //           },
      //           onTransactionAborted: function () {
      //             errorCallback();
      //           },
      //           environment: 'PRODUCTION',
      //           instruments: [],
      //           parameters: {
      //             orderId: '1464119848',
      //             merchantId: 'sachin_sharma'
      //           }
      //         });
      //       } else {
      //         errorCallback();
      //       }
      //     }
      // }
    },
    on:{
      pageInit: function (e, page) {
        if(localStorage.getItem('couponCode')!=null || localStorage.getItem('couponCode')!=''){
          $('#coupoSection').hide();
        }
        
        // app.onBackKeyDown(cartView);
      },
    }
  };
</script>
