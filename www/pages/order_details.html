<template>
  <div class="page">
    <div class="navbar" style="background: #125e97;">
      <div class="navbar-inner sliding">
        <div class="left">
          <a href="#" class="link back">
            <i class="icon icon-back color-white"></i>
            <span class="ios-only color-white">Back</span>
          </a>
        </div>
        <div class="title" style="color: #fff;margin: 0px;font-size:16px;">Order No. <span id="lblOrderNo"></span>
          <br>
          <small id="lblOrderStatus"></small>
        </div>
      </div>
    </div>
    <div class="page-content">
      <div id="trackingMap" style="height: 261px;margin-left: 0;margin-right: 0;width: 100%;position: relative;overflow: hidden;margin-bottom: 7%;"></div>
      <div class="block">
        <div class="row">
          <div class="col-10">
            <img src="img/placeholder.png"><br>
          </div>
          <div class="col-90">
            <strong id="lblRestaurentNameDelivery"></strong><br>
            <small style="font-size: 9px;" id="lblRestaurentAddress"></small>
          </div>
        </div>
        <div id="lblOrderId" style="display:none;">{{$route.params.id}}</div>
        <div class="row">
          <div class="col-10">
            <img src="img/flag.png">
          </div>
          <div class="col-90">
            <strong>Your Location</strong><br>
            <small style="font-size: 9px;" id="lblCustomerAddress"></small>
          </div>
        </div>
      </div>

      <div class="block-title">Menu Details</div>
      <div class="block">
        <div class="item-inner item-cell" id="lblOrderSummery">
          <!-- <div class="row">
            <div class="col" style="text-align: left;">Roasted Chili Pork (Dry) x 1</div>
            <div class="col" style="text-align: right;">100.00</div>
          </div>
          <div class="row">
            <div class="col" style="text-align: left;">Roasted Chili Pork (Dry) x 1</div>
            <div class="col" style="text-align: right;">100.00</div>
          </div>
          <div class="row">
            <div class="col" style="text-align: left;">Roasted Chili Pork (Dry) x 1</div>
            <div class="col" style="text-align: right;">100.00</div>
          </div> -->
        </div>
      </div>

      <div class="block-title">Bill Details</div>
      <div class="block">
        <div class="item-inner item-cell">
          <div class="row">
            <div class="col-80" style="text-align: left;">Item Total</div>
            <div class="col-20" style="text-align: right;" id="showHistoryTotal">100.00</div>
          </div>
          <div class="row">
            <div class="col-80" style="text-align: left;">Delivery Charge</div>
            <div class="col-20" style="text-align: right;" id="showHistoryDelivery">Free</div>
          </div>
          <div class="row">
            <div class="col-80" style="text-align: left;">GST</div>
            <div class="col-20" style="text-align: right;" id="showHistoryGST">-33.00</div>
          </div>
          <div class="row">
            <div class="col-80" style="color:green; text-align: left;">Coupon Discount</div>
            <div class="col-20" style="color:green; text-align: right;" id="showHistoryCouponDiscount">-33.00</div>
          </div>
          <div class="row">
            <div class="col-80" style="text-align: left;">
              <strong>To Pay</strong>
            </div>
            <div class="col-20" style="text-align: right;">
              <strong id="showHistoryTotalAmt">67.00</strong>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</template>
<script>
  return {
    on:{
      pageBeforeIn : function(e,page){

        let customerLocation = {
          lat: parseFloat(localStorage.getItem('lat')),
          lng: parseFloat(localStorage.getItem('lang'))
        };
        map = new google.maps.Map(document.getElementById('trackingMap'), {
          center: customerLocation,
          zoom: 12,
          mapTypeControl: false,
          disableDefaultUI: false,
          styles: [{
            elementType: 'geometry',
            stylers: [{ color: '#f5f5f5' }]
          },
          {
            elementType: 'labels.icon',
            stylers: [{ visibility: 'on' }]
          },
          {
            elementType: 'labels.text.fill',
            stylers: [{ color: '#616161' }]
          },
          {
            elementType: 'labels.text.stroke',
            stylers: [{ color: '#9a9a9a' }]
          },
          {
            featureType: 'administrative.land_parcel',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#bdbdbd' }]
          },
          {
            featureType: 'poi',
            elementType: 'geometry',
            stylers: [{ color: '#9a9a9a' }]
          },
          {
            featureType: 'poi',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#757575' }]
          },
          {
            featureType: 'poi.park',
            elementType: 'geometry',
            stylers: [{ color: '#e5e5e5' }]
          },
          {
            featureType: 'poi.park',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#9e9e9e' }]
          },
          {
            featureType: 'road',
            elementType: 'geometry',
            stylers: [{ color: '#ffffff' }]
          },
          {
            featureType: 'road.arterial',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#757575' }]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry',
            stylers: [{ color: '#dadada' }]
          },
          {
            featureType: 'road.highway',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#616161' }]
          },
          {
            featureType: 'road.local',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#9e9e9e' }]
          },
          {
            featureType: 'transit.line',
            elementType: 'geometry',
            stylers: [{ color: '#e5e5e5' }]
          },
          {
            featureType: 'transit.station',
            elementType: 'geometry',
            stylers: [{ color: '#eeeeee' }]
          },
          {
            featureType: 'water',
            elementType: 'geometry',
            stylers: [{ color: '#c9c9c9' }]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#9e9e9e' }]
          }
          ]
        });
        directionsDisplay = new google.maps.DirectionsRenderer({
          map: map,
          suppressMarkers: false
        });
        directionsService = new google.maps.DirectionsService();

        setTimeout(function(){
          $.ajax({
            type: "post",
            url: serverUrl + "get_delivery_status",
            data: { orderID: parseFloat($('#lblOrderId').html()) },
            dataType: "json"
          }).done(function(rply){
            if(!rply.isPickedUp) {
                if ((parseFloat(res.restaurantLocation.lat) !== lastRestaurant.lat) || (parseFloat(res.restaurantLocation.lng) !== lastRestaurant.lng)) {
                  try {
                    line.setMap(null);
                  } catch (e) {
                    console.log(e);
                  }
                  line = new google.maps.Polyline({
                    path: [{
                      lat: parseFloat(res.restaurantLocation.lat),
                      lng: parseFloat(res.restaurantLocation.lng)
                    }, customerLocation],
                    strokeOpacity: 0,
                    icons: [{
                      icon: {
                        path: 'M 0,-1 0,1',
                        strokeOpacity: 1,
                        scale: 2
                      },
                      offset: '0',
                      repeat: '15px'
                    }],
                    map: map
                  });
                  lastRestaurant = {
                    lat: parseFloat(res.restaurantLocation.lat),
                    lng: parseFloat(res.restaurantLocation.lng)
                  };
                  var latlngbounds = new google.maps.LatLngBounds();
                  latlngbounds.extend(lastRestaurant);
                  latlngbounds.extend(customerLocation);
                  map.fitBounds(latlngbounds);
                }

              } else {
                line.setMap(null);
                line = null;
              }
              // -----------------
          });
        }, 3000);
      }
    },
  };
</script>